<!DOCTYPE html>
<html>
    <head>
        <title>Anime OPs</title>
        <script src='./resources/ops.js'></script>
        <script src='../libary/sg.js'></script>
        <link rel="stylesheet" href="./resources/ops.css">
    </head>
    <body>
        <button id='keepplaying'></button>
        <p id='playlistlength' style='display: none;'></p>
        <div id='playlist'></div>

        <script src="https://www.youtube.com/player_api"></script>
        <div id='videoplayer'></div>

        <script>
            // create youtube player
            var player, width=560, height=315
            if(sg.onMobile()){
                var ratio = height / width
                width=window.innerWidth;height=window.innerWidth * ratio
            }

            function onYouTubePlayerAPIReady() {
                player = new YT.Player('videoplayer', {
                height: height.toString(),
                width: width.toString(),
                videoId: '',
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
                });
            }

            // autoplay video
            function onPlayerReady(event) {
                event.target.playVideo();
            }

            // when video ends
            function onPlayerStateChange(event) {        
                if(event.data === YT.PlayerState.ENDED) {
                    var time = new Date().getTime(),
                        difference = time - lastLoad

                    if(keepPlaying && difference >= 2 * 1000) { // at least two seconds after pervious one
                        play(vidIds[vidPos++])
                        console.log(vidPos)
                    }
                    lastLoad = time;
                }
            }
        </script>
    </body>
</html>