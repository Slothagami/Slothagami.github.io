<!DOCTYPE html>
<html>
    <head>
        <title>Anime OPs</title>

        <script src='./resources/ops.js'></script>
        <script src='../libary/sg.js'></script>
        
        <link rel="stylesheet" href="./resources/ops.css">
    </head>
    <body>
        <button id='keepplaying'></button>
        <p id='playlistlength' style='display: none;'></p>
        <div id='playlist'></div>

        <script src="https://www.youtube.com/player_api"></script>
        <div id='videoplayer'></div>

        <script>
            // create youtube player
            setVideoVisible(false)

            var player, 
                defWidth=560, 
                defHeight=315, 
                ratio = defHeight / defWidth,
                width = sg.onMobile()? window.innerWidth: window.innerWidth * 0.7,//0.45,
                height = width * ratio

            function onYouTubePlayerAPIReady() {
                player = new YT.Player('videoplayer', {
                    height: height.toString(),
                    width: width.toString(),
                    videoId: '',
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });
            }

            // autoplay video
            function onPlayerReady(event) {
                event.target.playVideo();
            }

            // when video ends
            function onPlayerStateChange(event) {    
                // Running on video start too 
                //console.log(event.data) // englishafy
                
                if(event.data === YT.PlayerState.ENDED) {
                    var time = new Date().getTime(),
                        difference = time - lastLoad    

                    if(difference >= 2 * 1000) { // at least two seconds after pervious one
                        if(keepPlaying) {
                            play(que[vidPos++])
                            console.log('Incriment Video')
                        } else if(!keepPlaying) {
                            setVideoVisible(false)
                            console.log('Hide Video')
                        }
                    }
                    lastLoad = time;
                }
            }
        </script>
    </body>
</html>